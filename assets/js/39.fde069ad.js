(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{427:function(t,s,a){"use strict";a.r(s);var e=a(0),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"场景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#场景"}},[t._v("#")]),t._v(" 场景")]),t._v(" "),s("ul",[s("li",[t._v("有时中间件并发量很大，会提示单据/数据库锁定")]),t._v(" "),s("li",[t._v("这个时候，需要排查中间件的业务锁，事务锁，也需要排查数据库的锁")])]),t._v(" "),s("h2",{attrs:{id:"排查数据库死锁"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#排查数据库死锁"}},[t._v("#")]),t._v(" 排查数据库死锁")]),t._v(" "),s("ul",[s("li",[t._v("查询表锁定")])]),t._v(" "),s("div",{staticClass:"language-sql line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sid         "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("serial")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    , a.oracle_username , a.os_user_name , ")]),t._v("\n       b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("object_name "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("locked_mode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("machine         "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("event\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" v$locked_object a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dba_objects b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" v$"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("session")]),t._v(" c\n "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("object_id  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("object_id\n   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("session_id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sid\n   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("oracle_username "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'数据库用户名大写'")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("ul",[s("li",[t._v("查询结果")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("SID")]),t._v(" "),s("th",[t._v("SERIAL#")]),t._v(" "),s("th",[t._v("OBJECT_NAME")]),t._v(" "),s("th",[t._v("LOCKED_MODE")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("964")]),t._v(" "),s("td",[t._v("2995")]),t._v(" "),s("td",[t._v("TBL_MESSAGE_CALL_INFO")]),t._v(" "),s("td",[t._v("3")])]),t._v(" "),s("tr",[s("td",[t._v("830")]),t._v(" "),s("td",[t._v("3721")]),t._v(" "),s("td",[t._v("TBL_MESSAGE_CALL_INFO")]),t._v(" "),s("td",[t._v("3")])]),t._v(" "),s("tr",[s("td",[t._v("682")]),t._v(" "),s("td",[t._v("2749")]),t._v(" "),s("td",[t._v("TBL_MESSAGE_CALL_INFO")]),t._v(" "),s("td",[t._v("3")])]),t._v(" "),s("tr",[s("td",[t._v("636")]),t._v(" "),s("td",[t._v("8015")]),t._v(" "),s("td",[t._v("TBL_MESSAGE_CALL_INFO")]),t._v(" "),s("td",[t._v("3")])]),t._v(" "),s("tr",[s("td",[t._v("337")]),t._v(" "),s("td",[t._v("6775")]),t._v(" "),s("td",[t._v("TBL_MESSAGE_CALL_INFO")]),t._v(" "),s("td",[t._v("3")])]),t._v(" "),s("tr",[s("td",[t._v("201")]),t._v(" "),s("td",[t._v("10643")]),t._v(" "),s("td",[t._v("FTS_PAYMENTRECEIPT")]),t._v(" "),s("td",[t._v("3")])]),t._v(" "),s("tr",[s("td",[t._v("201")]),t._v(" "),s("td",[t._v("10643")]),t._v(" "),s("td",[t._v("FTS_ACCOUNT_DETAIL")]),t._v(" "),s("td",[t._v("3")])])])]),t._v(" "),s("h2",{attrs:{id:"lock-mode-是什么"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lock-mode-是什么"}},[t._v("#")]),t._v(" lock mode 是什么")]),t._v(" "),s("ul",[s("li",[t._v("上面的查询结果，locked_mode值为3，这是什么意思")]),t._v(" "),s("li",[t._v("lock mode值的含义如下\n数值 | 英文含义 | 中文\n-- | -- | --\n0 | none |\n1 | null | 空\n2 | Row-S: sub share | 行共享\n3 | Row-X: sub exclusive | 行独占\n4 | Share | 共享，阻止其他DML操作\n5 | S/Row-X | 共享行独占，阻止其他事务操作\n6 | X:exclusive | 独立访问")])]),t._v(" "),s("h2",{attrs:{id:"lock-type-是什么"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lock-type-是什么"}},[t._v("#")]),t._v(" lock type 是什么")]),t._v(" "),s("ul",[s("li",[t._v("查询lock type")])]),t._v(" "),s("div",{staticClass:"language-sql line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" v$lock_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("ul",[s("li",[t._v("最常见的lock type")])]),t._v(" "),s("div",{staticClass:"language-sql line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" v$lock_type "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'TM'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'TX'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("ul",[s("li",[t._v("lock type 是比 lock mode 更细小的概念")]),t._v(" "),s("li",[t._v("TM, TX对应的lock mode数值是3")])]),t._v(" "),s("h2",{attrs:{id:"mark-理解透彻了再补充"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mark-理解透彻了再补充"}},[t._v("#")]),t._v(" Mark 理解透彻了再补充")])])}),[],!1,null,null,null);s.default=n.exports}}]);