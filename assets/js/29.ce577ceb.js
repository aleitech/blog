(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{572:function(s,a,t){"use strict";t.r(a);var n=t(5),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"场景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#场景"}},[s._v("#")]),s._v(" 场景")]),s._v(" "),t("ul",[t("li",[s._v("数据库可能发生死锁了，重启数据库是最简单粗暴的方案")]),s._v(" "),t("li",[s._v("有时没有服务器的权限，有时甲方使用小型机导致条件严苛，不能重启数据库，只能死磕数据库的锁")])]),s._v(" "),t("h2",{attrs:{id:"排查数据库死锁"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#排查数据库死锁"}},[s._v("#")]),s._v(" 排查数据库死锁")]),s._v(" "),t("ul",[t("li",[s._v("查询表锁定")])]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sid         "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("serial")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    , a.oracle_username , a.os_user_name , ")]),s._v("\n       b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("object_name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("locked_mode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("machine         "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("event\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" v$locked_object a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dba_objects b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("session")]),s._v(" c\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("object_id  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("object_id\n   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("session_id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sid\n   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oracle_username "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'数据库用户名大写'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h2",{attrs:{id:"数据库级解除表锁定"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据库级解除表锁定"}},[s._v("#")]),s._v(" 数据库级解除表锁定")]),s._v(" "),t("ul",[t("li",[s._v("解除表锁定")])]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" system "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("kill")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("session")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sid,serial#'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n例如\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" system "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("kill")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("session")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'107,4801'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ul",[t("li",[s._v("拼接所有解锁语句，查询后，复制全部结果直接执行")])]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'alter system kill session '''")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("','")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("serial")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# || ''';' as 要执行的语句,")]),s._v("\n       a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oracle_username "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("os_user_name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("object_name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("locked_mode\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" v$locked_object a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dba_objects b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("session")]),s._v(" c\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("object_id  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("object_id\n   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("session_id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sid\n   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oracle_username "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'数据库用户名大写'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("ul",[t("li",[s._v("执行后，不是所有的表锁定都能解除，剩下的需要操作系统级释放")])]),s._v(" "),t("h2",{attrs:{id:"操作系统级解除表锁定"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#操作系统级解除表锁定"}},[s._v("#")]),s._v(" 操作系统级解除表锁定")]),s._v(" "),t("ul",[t("li",[s._v("查询出spid")])]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("serial")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#, a.oracle_username , a.os_user_name ,")]),s._v("\n       b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("object_name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("locked_mode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("spid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("program\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" v$locked_object a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dba_objects b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("session")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v$process d\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("object_id  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("object_id\n   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("session_id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sid\n   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("paddr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("addr\n   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("oracle_username "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'数据库用户名大写'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("ul",[t("li",[s._v("根据spid，用操作系统的shell，杀死线程")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("unix适用\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kill -9 某个spid")]),s._v("\nwindows和unix都适用\n  orakill sid spid  举例： orakill orcl "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12345")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);