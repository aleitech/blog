(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{532:function(t,s,a){"use strict";a.r(s);var e=a(3),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#场景"}},[t._v("#")]),t._v(" 场景")]),t._v(" "),a("ul",[a("li",[t._v("有时中间件并发量很大，会提示单据/数据库锁定")]),t._v(" "),a("li",[t._v("这个时候，需要排查中间件的业务锁，事务锁，也需要排查数据库的锁")])]),t._v(" "),a("h2",{attrs:{id:"排查数据库死锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#排查数据库死锁"}},[t._v("#")]),t._v(" 排查数据库死锁")]),t._v(" "),a("ul",[a("li",[t._v("查询表锁定")])]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sid         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("serial")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    , a.oracle_username , a.os_user_name , ")]),t._v("\n       b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("object_name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("locked_mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("machine         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("event\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" v$locked_object a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dba_objects b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" v$"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("session")]),t._v(" c\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("object_id  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("object_id\n   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("session_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sid\n   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("oracle_username "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'数据库用户名大写'")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("ul",[a("li",[t._v("查询结果")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("SID")]),t._v(" "),a("th",[t._v("SERIAL#")]),t._v(" "),a("th",[t._v("OBJECT_NAME")]),t._v(" "),a("th",[t._v("LOCKED_MODE")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("964")]),t._v(" "),a("td",[t._v("2995")]),t._v(" "),a("td",[t._v("TBL_MESSAGE_CALL_INFO")]),t._v(" "),a("td",[t._v("3")])]),t._v(" "),a("tr",[a("td",[t._v("830")]),t._v(" "),a("td",[t._v("3721")]),t._v(" "),a("td",[t._v("TBL_MESSAGE_CALL_INFO")]),t._v(" "),a("td",[t._v("3")])]),t._v(" "),a("tr",[a("td",[t._v("682")]),t._v(" "),a("td",[t._v("2749")]),t._v(" "),a("td",[t._v("TBL_MESSAGE_CALL_INFO")]),t._v(" "),a("td",[t._v("3")])]),t._v(" "),a("tr",[a("td",[t._v("636")]),t._v(" "),a("td",[t._v("8015")]),t._v(" "),a("td",[t._v("TBL_MESSAGE_CALL_INFO")]),t._v(" "),a("td",[t._v("3")])]),t._v(" "),a("tr",[a("td",[t._v("337")]),t._v(" "),a("td",[t._v("6775")]),t._v(" "),a("td",[t._v("TBL_MESSAGE_CALL_INFO")]),t._v(" "),a("td",[t._v("3")])]),t._v(" "),a("tr",[a("td",[t._v("201")]),t._v(" "),a("td",[t._v("10643")]),t._v(" "),a("td",[t._v("FTS_PAYMENTRECEIPT")]),t._v(" "),a("td",[t._v("3")])]),t._v(" "),a("tr",[a("td",[t._v("201")]),t._v(" "),a("td",[t._v("10643")]),t._v(" "),a("td",[t._v("FTS_ACCOUNT_DETAIL")]),t._v(" "),a("td",[t._v("3")])])])]),t._v(" "),a("h2",{attrs:{id:"lock-mode-是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#lock-mode-是什么"}},[t._v("#")]),t._v(" lock mode 是什么")]),t._v(" "),a("ul",[a("li",[t._v("上面的查询结果，locked_mode值为3，这是什么意思")]),t._v(" "),a("li",[t._v("lock mode值的含义如下\n数值 | 英文含义 | 中文\n-- | -- | --\n0 | none |\n1 | null | 空\n2 | Row-S: sub share | 行共享\n3 | Row-X: sub exclusive | 行独占\n4 | Share | 共享，阻止其他DML操作\n5 | S/Row-X | 共享行独占，阻止其他事务操作\n6 | X:exclusive | 独立访问")])]),t._v(" "),a("h2",{attrs:{id:"lock-type-是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#lock-type-是什么"}},[t._v("#")]),t._v(" lock type 是什么")]),t._v(" "),a("ul",[a("li",[t._v("查询lock type")])]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" v$lock_type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("ul",[a("li",[t._v("最常见的lock type")])]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" v$lock_type "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("in")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'TM'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'TX'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("ul",[a("li",[t._v("lock type 是比 lock mode 更细小的概念")]),t._v(" "),a("li",[t._v("TM, TX对应的lock mode数值是3")])]),t._v(" "),a("h2",{attrs:{id:"mark-理解透彻了再补充"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mark-理解透彻了再补充"}},[t._v("#")]),t._v(" Mark 理解透彻了再补充")])])}),[],!1,null,null,null);s.default=n.exports}}]);